const addCSS=e=>(t=>{t.head.appendChild(t.createElement("style")).innerHTML=e})(document),isDark=e=>{if(e.startsWith("#")){let t=e;e=t.substring(1),e=parseInt(e,16);return.2126*(e>>16&255)+.7152*(e>>8&255)+.0722*(e>>0&255)<70}},createFrameElement=(t,e)=>{const n=document.createElement("iframe");n.id=e?.containerId?`${e.containerId}-iframe`:"granularity-iframe";let o=`?hn=${window.location.hostname}`;if(e.starterVariables)for(var a in e.starterVariables){var r=e.starterVariables[a];null!=r&&(o+=`&${a}=${encodeURIComponent(r)}`)}t=t.startsWith("https")?`${t}${o}`:`https://app-dev.getgranularity.com/form/${t}`;e.lazy?n.dataset.src=t:n.src=t,n.setAttribute("allowfullscreen","true"),n.referrerPolicy="origin";let i="rgba(255,255,255,0)";return e?.loadingBackgroundColor?i=e.loadingBackgroundColor:e?.loadingColors&&(i=e.loadingColors.chatBackground),n.style=`border-radius: inherit; width: 100%; height: 100%; background-color: ${i}; border: 0`,window.addEventListener("message",t=>{"granularity"===t.data.from&&t.data.redirectUrl&&window.open(t.data.redirectUrl)}),n},createPopup=(t,e)=>{const n=document.createElement("div");n.style="width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.25); position: fixed; z-index: 99999; display: none; justify-content: center; align-items: center";const o=document.createElement("div");o.style=`width: 70%; height: 70%; border-radius: 5px; position: relative; max-width: 900px; background-color: ${e.loadingBackgroundColor??"#ffffff"}`;const a=document.createElement("button");a.setAttribute("aria-label","Close granularity popup"),a.style="position: absolute; top: 10px; right: 10px; width: 50px; height: 50px; cursor: pointer; background: none; border: none; outline: none",a.innerHTML='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%;"><path d="M278.6 256l68.2-68.2c6.2-6.2 6.2-16.4 0-22.6-6.2-6.2-16.4-6.2-22.6 0L256 233.4l-68.2-68.2c-6.2-6.2-16.4-6.2-22.6 0-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3l68.2 68.2-68.2 68.2c-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3 6.2 6.2 16.4 6.2 22.6 0l68.2-68.2 68.2 68.2c6.2 6.2 16.4 6.2 22.6 0 6.2-6.2 6.2-16.4 0-22.6L278.6 256z"></path></svg>',o.appendChild(a);const r=createFrameElement(t,{...e,lazy:!0});o.appendChild(r),n.appendChild(o),document.body.style.overflow="hidden",document.body.style.height="100%";const i=(t,e)=>{t.src||(t.src=t.dataset.src),e.style.display="flex"};return void 0!==e?.delay&&setTimeout(()=>i(r,n),e?.delay??0),window.addEventListener("message",t=>{"open-granularity-popup"===t.data.action&&i(r,n)}),n.addEventListener("click",t=>{let e=t.target;do{if(e==o)return}while(e=e.parentNode,e);document.body.style.overflow="auto",document.body.style.height="auto",n.style.display="none"}),a.onclick=()=>{document.body.style.overflow="auto",document.body.style.height="auto",n.style.display="none"},n},createChat=({id:t,buttonColor:e,proactiveMessage:n,iconUrl:o,params:a})=>{addCSS("\n  .sbl-circ {\n    position: absolute;\n    display: inline-block;\n    border: 2px solid;\n    border-radius: 50%;\n    width: 25px;\n    height: 25px;\n    color: #0042DA;\n    border-top-color: transparent;\n    animation: rotate 1s linear infinite;\n  }\n  \n  @keyframes rotate {\n    0% {\n      transform: rotate(0);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n  \n  .granularity-chat-icon,\n  .granularity-chat-close {\n    transition: all .35s ease-in-out;\n  }\n\n  .granularity-chat-button.active .granularity-chat-icon{\n    transform: rotate( 90deg ) scale( 0 );\n    opacity: 0;\n  }\n  \n  .granularity-chat-button:not( .active ) .granularity-chat-close{\n    transform: rotate( -90deg ) scale( 0 );\n    opacity: 0;\n  }\n\n  .granularity-iframe-container:not( .active ) {\n    opacity: 0;\n    transform: translate(0, 100px);\n  }\n  .granularity-iframe-container.active {\n    opacity: 1;\n    transform: translate(0, 0);\n  }\n\n  .bubbleCallOut {\n    font-size: 18px;\n    color: #303235;\n    opacity: 0;\n    transform: translate(0, 10px);\n    transition: opacity 500ms ease-out, transform 500ms ease-out;\n    cursor:pointer ;font-weight: 300;\n    bottom: 90px;\n    right:20px;\n    z-index: 99999;\n    position: fixed;\n    max-width: 280px;\n    background-color: white;\n    box-shadow: 0 3px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n    padding: 16px;\n    display: flex;\n    align-items: center;\n    border-radius: 8px;\n  }\n\n  .granularity-mobile-footer {\n    display: none;\n  }\n  @media screen and (max-width: 450px) {\n    .bubbleCallOut {\n      max-width: 200px;\n      font-size: 15px;\n      bottom: 70px;\n      right: 10px;\n    }\n\n    .granularity-chat-button {\n      width: 50px !important;\n      height: 50px !important;\n      bottom: 10px !important;\n      right: 10px !important;\n    }\n\n    .granularity-mobile-footer {\n      display: block;\n    }\n  }\n\n  .bubble-typing {\n    transition: width 400ms ease-out, height 400ms ease-out;\n  }\n  \n  .bubble1 {\n    animation: chatBubbles 1s ease-in-out infinite;\n  }\n  \n  .bubble2 {\n    animation: chatBubbles 1s ease-in-out infinite;\n    animation-delay: 0.3s;\n  }\n  \n  .bubble3 {\n    animation: chatBubbles 1s ease-in-out infinite;\n    animation-delay: 0.5s;\n  }\n  \n  @keyframes chatBubbles {\n    0% {\n      transform: translateY(0);\n    }\n    50% {\n      transform: translateY(-5px);\n    }\n    100% {\n      transform: translateY(0);\n    }\n  }\n  ");const r=t=>{window.innerWidth<=800?"100%"!==t.style.width&&(t.style.width="100%",t.style.height="100%",t.style.top=0,t.style.left=0,t.style.maxHeight="100%"):"400px"!==t.style.width&&(t.style.width="400px",t.style.maxHeight="680px",t.style.left="auto",t.style.top="auto",t.style.bottom="90px",t.style.right="20px",t.style.height="calc(100% - 160px)")},i=(t,e,n)=>{n.src||(n.src=n.dataset.src,setTimeout(()=>{b.remove()},500),localStorage.setItem("openedChat","true")),t.classList.toggle("active"),e.classList.toggle("active"),e.className.includes("active")?(e.style.visibility="visible",window.innerWidth<=800&&(document.body.style.overflow="hidden",document.body.style.height="100%")):(setTimeout(()=>{e.style.visibility="hidden"},600),window.innerWidth<=800&&(document.body.style.overflow="auto",document.body.style.height="auto"))},l=document.getElementById("granularity-chat-container");l&&l.remove();const s=document.createElement("div");s.id="granularity-chat-container";let d,c;if(n&&!1===n.remember&&localStorage.removeItem("openedChat"),n&&!localStorage.getItem("openedChat")){if(d=document.createElement("div"),setTimeout(()=>{d.style.opacity="1",d.style.transform="translate(0, 0)"},n.delay),d.className="bubbleCallOut",n.avatar){const w=document.createElement("div");w.style="margin-right: 8px; width: 40px; height: 40px; flex-shrink:0; display: flex; align-items: flex-end;";const f=document.createElement("img");f.src=n.avatar,f.style="width: 100%; border-radius: 100%;",w.appendChild(f),d.appendChild(w)}d.innerHTML+=n.textContent,c=document.createElement("button"),c.setAttribute("aria-label","Close granularity preview"),c.style="position: absolute; top: -15px; right: -7px; width: 30px; height: 30px; background-color: #edf2f7; border-radius: 100%; border: none; outline: none; color:black; padding: 0; cursor:pointer",c.innerHTML='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" style="width: 25px; height: 25px; margin-top: 2px"><path d="M278.6 256l68.2-68.2c6.2-6.2 6.2-16.4 0-22.6-6.2-6.2-16.4-6.2-22.6 0L256 233.4l-68.2-68.2c-6.2-6.2-16.4-6.2-22.6 0-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3l68.2 68.2-68.2 68.2c-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3 6.2 6.2 16.4 6.2 22.6 0l68.2-68.2 68.2 68.2c6.2 6.2 16.4 6.2 22.6 0 6.2-6.2 6.2-16.4 0-22.6L278.6 256z"></path></svg>',d.append(c),s.prepend(d)}const p=document.createElement("button");p.className="granularity-chat-button",p.style=`padding: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 99999; position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 100%; background-color: ${e}; box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.06), 0 2px 32px 0 rgba(0, 0, 0, 0.16); border: none; outline: none`,p.setAttribute("aria-label","Open granularity chat");const u=document.createElement("div");u.style="display:flex;",u.className="granularity-chat-icon",""!==o&&o.startsWith("https")?u.innerHTML=`<img src="${o}" style="width: 40px; height: 40px"/>`:u.innerHTML='<svg style="width: 32px" height="19px" viewBox="0 0 41 19" fill="none" xmlns="http://www.w3.org/2000/svg" > <rect x="40.29" y="0.967773" width="6.83761" height="30.7692" rx="3.4188" transform="rotate(90 40.29 0.967773)" fill="white"/> <path fill-rule="evenodd" clip-rule="evenodd" d="M3.70884 7.80538C5.597 7.80538 7.12765 6.27473 7.12765 4.38658C7.12765 2.49842 5.597 0.967773 3.70884 0.967773C1.82069 0.967773 0.290039 2.49842 0.290039 4.38658C0.290039 6.27473 1.82069 7.80538 3.70884 7.80538Z" fill="white"/> <rect x="0.290039" y="18.0615" width="6.83761" height="30.7692" rx="3.4188" transform="rotate(-90 0.290039 18.0615)" fill="white"/> <path fill-rule="evenodd" clip-rule="evenodd" d="M36.8712 11.2239C34.9831 11.2239 33.4524 12.7546 33.4524 14.6427C33.4524 16.5309 34.9831 18.0615 36.8712 18.0615C38.7594 18.0615 40.29 16.5309 40.29 14.6427C40.29 12.7546 38.7594 11.2239 36.8712 11.2239Z" fill="white"/> </svg>';const h=document.createElement("div");h.style="position: absolute; display: flex; justify-content: center",h.className="granularity-chat-close",h.innerHTML='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" style="width: 80%; height: 80%; color: white;" > <path d="M278.6 256l68.2-68.2c6.2-6.2 6.2-16.4 0-22.6-6.2-6.2-16.4-6.2-22.6 0L256 233.4l-68.2-68.2c-6.2-6.2-16.4-6.2-22.6 0-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3l68.2 68.2-68.2 68.2c-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3 6.2 6.2 16.4 6.2 22.6 0l68.2-68.2 68.2 68.2c6.2 6.2 16.4 6.2 22.6 0 6.2-6.2 6.2-16.4 0-22.6L278.6 256z" ></path></svg >',p.appendChild(u),p.appendChild(h);let g={chatBackground:"#ffffff",bubbleBackground:"rgb(247, 248, 255)",typingDots:"rgb(48, 50, 53)"};a?.colors?.loadingBackgroundColor?g.chatBackground=a.colors?.loadingBackgroundColor:a?.colors?.loadingColors&&(g={...a.colors.loadingColors});const m=document.createElement("div");m.className="granularity-iframe-container",m.style=`visibility: hidden; display:flex; flex-direction: column; justify-content: center; align-items: center; z-index: 99999; background-color: ${g.chatBackground}; border-radius: 10px; position: fixed; transition: opacity 500ms ease-out, transform 500ms ease-out; box-shadow: rgba(0, 0, 0, 0.16) 0px 5px 40px; `;const y=document.createElement("div");y.className="granularity-mobile-footer",y.style=`height: 70px; background-color: ${g.chatBackground}; width:100%; flex-shrink: 0; border-radius: 10px;`;const b=document.createElement("div");b.className="sbl-circ",b.style=`color: ${g.typingDots}`,m.appendChild(b);const x=createFrameElement(t,{lazy:!0,...a,loadingColors:g});return m.appendChild(x),m.appendChild(y),p.onclick=()=>{d&&d.remove(),i(p,m,x,b)},window.addEventListener("message",t=>{var e,n;"open-granularity-chat"===t.data.action&&(e=p,n=m,(t=x).src||(t.src=t.dataset.src,setTimeout(()=>{b.remove()},500),localStorage.setItem("openedChat","true")),n.className.includes("active")||(e.classList.toggle("active"),n.classList.toggle("active"),n.style.visibility="visible",window.innerWidth<=800&&(document.body.style.overflow="hidden",document.body.style.height="100%")))}),d&&(d.onclick=()=>{d.remove(),i(p,m,x)},c.onclick=t=>{t.stopPropagation(),d.remove(),n.remember&&localStorage.setItem("openedChat","true")}),s.appendChild(m),s.appendChild(p),r(m),window.onresize=()=>{r(m)},s};class Granularity{constructor(t){this.type=t}open(){window.postMessage({action:"chat"===this.type?"open-granularity-chat":"open-granularity-popup"})}static Fullpage(t){return window.addEventListener("load",()=>{document.body.append(createFrameElement(t.formId,{loadingBackgroundColor:t?.loadingBackgroundColor,starterVariables:t?.starterVariables}))},!1),new Granularity}static Container(n){const t=document.querySelector(`#${n.containerId}`);document.querySelector(`#${n.containerId}-iframe`)||t.appendChild(createFrameElement(n.formId,{loadingBackgroundColor:n?.loadingBackgroundColor,starterVariables:n?.starterVariables,lazy:!0,containerId:n?.containerId}));const e=new IntersectionObserver(function(t){if(!0===t.pop()?.isIntersecting){const e=document.querySelector(`#${n.containerId}-iframe`);e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"))}},{threshold:[0]});return e.observe(t),new Granularity}static Popup(t){var e=()=>{document.body.prepend(createPopup(t.formId,{loadingBackgroundColor:t?.loadingBackgroundColor,starterVariables:t?.starterVariables,delay:t?.delay}))};return"complete"===document.readyState?e():window.addEventListener("load",e,!1),new Granularity("popup")}static Chat(t){var e=()=>document.body.prepend(createChat({id:t.formId,buttonColor:t.buttonColor,proactiveMessage:t.proactiveMessage??null,iconUrl:t.buttonIconUrl??"",params:{starterVariables:t?.starterVariables,colors:{loadingBackgroundColor:t?.loadingBackgroundColor,loadingColors:t?.loadingColors}}}));return"complete"===document.readyState?e():window.addEventListener("load",e,!1),new Granularity("chat")}remove(){document.getElementById("granularity-chat-container").remove()}}
